<html ng-app="hermius">
<head>
	<title>Hermius</title>
	
	<script src="https://www.atlasestateagents.co.uk/javascript/tether.min.js"></script><!-- Tether for Bootstrap --> 
	<!-- jQuery -->
    <script src="js/jquery.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="js/bootstrap.min.js"></script>

	<!-- Bootstrap Core JavaScript -->
    <script src="bootstrap/js/bootstrap.js"></script>

    <!-- Bootstrap Core CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet">

    <!-- Morris Charts CSS -->
    <link href="css/plugins/morris.css" rel="stylesheet">

    <!-- Custom Fonts -->
    <link href="font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">

	<!-- Angular Animate -->
	<!--<script src="path/to/angular.js"></script>-->
	<!--<script src="/node_modules/angular-animate/angular-animate.js"></script>-->

    

	<!-- Sign in stylesheet -->
	<link rel="stylesheet" type="text/css" href="css/login-style.css" />
	<!-- Sign up stylesheet -->
	<link rel="stylesheet" type="text/css" href="css/signup-style.css" />
	<!-- Landing Page stylesheet -->
	<link rel="stylesheet" type="text/css" href="css/landing-style.css" />
	<!-- NEW Landing Page stylesheet -->
    <link href="css/landing-page.css" rel="stylesheet">

	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.4/css/bootstrap.min.css" integrity="sha384-2hfp1SzUoho7/TsGGGDaFdsuuDL0LX2hnUp6VkX3CUQ2K4K+xjboZdsXyp4oUHZj" crossorigin="anonymous">
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.4/js/bootstrap.min.js" integrity="sha384-VjEeINv9OSwtWFLAtmc4JCtEJXXBub00gtSnszmspDLCtC0I4z4nqz7rEFbIZLLU" crossorigin="anonymous"></script>

	<script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
	<link rel="stylesheet" type="text/css" href="bootstrap/css/bootstrap.css">
	<!-- Custom Stylesheets -->
	<link rel="stylesheet" type="text/css" href="style.css">
	<script type="text/javascript" src="angular.min.js"></script>
	<script type="text/javascript" src="angular-route.js"></script>
	<script type="text/javascript" src="angular-cookies.js"></script>
	<script src="http://localhost:80/socket.io/socket.io.js"></script>

	

    <!-- Morris Charts JavaScript -->
    <script src="js/plugins/morris/raphael.min.js"></script>
    <script src="js/plugins/morris/morris.min.js"></script>
    <script src="js/plugins/morris/morris-data.js"></script>
	
	<script type="text/javascript">
		var app = angular.module('hermius', ['ngRoute', 'ngCookies']);

		var meetingRoomName, meetingTaskName, meetingTeamName,selectedUser;
		var roomNumber = 1;
		var linkButton = false;
		var taskButton = false;
		var fileButton = false;
        
		app.config(function($routeProvider, $locationProvider){
			$routeProvider
		   .when('/home', {
		    templateUrl: 'home2.html',
		    controller: 'HomeController',
			})

		   .when('/', {
		    templateUrl: 'landingpage2.html',
		    controller: 'HomeController',
			})

			.when('/landingEX', {
		    templateUrl: 'landingpage.html',
		    controller: 'HomeController',
			})

			.when('/signup', {
		    templateUrl: 'signup2.html',
		    controller: 'SignupController',
			})

			.when('/signin', {
		    templateUrl: 'signin2.html',
		    controller: 'HomeController',
			})
			.when('/room', {
		    templateUrl: 'room.html',
		    controller: 'RoomController',
			})
			.when('/home/:meetingRoomName', {
		    templateUrl: 'home2.html',
		    controller: 'HomeController',
			}) 
			.when('/room/:meetingRoomName', {
		    templateUrl: 'room.html',
		    controller: 'RoomController',
			})
			.when('/user/profile', {
		    templateUrl: 'userProfile.html',
		    controller: 'RoomController',
			})
			.when('/profile', {
		     templateUrl: 'profile.html',
		    controller: 'profileController',
			 });     
		});

		app.run(function($rootScope, $cookies){
			if($cookies.get('token') && $cookies.get('currentUser')) {
				$rootScope.token = $cookies.get('token');
				$rootScope.currentUser = $cookies.get('currentUser');
			}
			if($cookies.get('roomToken') && $cookies.get('roomName')) {
				$rootScope.roomToken = $cookies.get('roomToken');
				$rootScope.roomName = $cookies.get('roomName');
				meetingRoomName = $rootScope.roomName;
			}
			if($cookies.get('taskToken') && $cookies.get('taskName')) {
				$rootScope.taskToken = $cookies.get('taskToken');
				$rootScope.taskName = $cookies.get('taskToken');
				meetingTaskName = $rootScope.taskToken;
			}
		});
		
		app.directive('schrollBottom', function () {
		return {
			scope: {
			schrollBottom: "="
			},
			link: function (scope, element) {
			scope.$watchCollection('schrollBottom', function (newValue) {
				if (newValue)
				{
				$(element).scrollTop($(element)[0].scrollHeight);
				}
			});
			}
		}
		});

		app.directive('fileModel', ['$parse', function ($parse) {
            return {
               restrict: 'A',
               link: function(scope, element, attrs) {
                  var model = $parse(attrs.fileModel);
                  var modelSetter = model.assign;
                  
                  
                  
                  element.bind('change', function(evt){
                     scope.$apply(function(){
                        modelSetter(scope, element[0].files[0]);
                        
                     });
                  });
               }
            };
         }]);
		 

		/*
		This directive allows us to pass a function in on an enter key to do what we want.
		*/
		app.directive('ngEnter', function () {
			return function (scope, element, attrs) {
				element.bind("keydown keypress", function (event) {
					if(event.which === 13) {
						scope.$apply(function (){
							scope.$eval(attrs.ngEnter);
						});
		
						event.preventDefault();
					}
				});
			};
		});



		app.controller('profileController',function($scope,$rootScope,$http){

			$scope.currentUser=$rootScope.currentUser;
			$scope.imgSrc="default.png";

			function showUserProfile()
			{
				$http.put('/show/User/profile',{name:$rootScope.currentUser}).then(function(response){
							//console.log($rootScope.currentUser);
							//console.log($rootScope.meetingTaskName);
							$scope.userProfile = response.data;
							$rootScope.userProfile=$scope.userProfile;
							//console.log(response.data);
								//$scope.users=response.data;
							});
			}

			showUserProfile();
                 
			$scope.myFile={username:$rootScope.currentUser};

			$scope.submit = function()
			{
				
				var file =$scope.myFile.file;

				var filename=file.name
				console.log(filename);
				var extn = filename.split(".").pop();
						console.log(extn);
						if( extn == 'jpg' || extn == 'jpeg' || extn == 'png' || extn == 'gif')
							console.log("file uploaded");
						else {
							$scope.filetype="file";
							 $scope.myFile={};
							 alert("Choose image type file");
							 location.reload();
						}
            
               var fd = new FormData();
               for(var key in $scope.myFile)
               
               fd.append(key,$scope.myFile[key]);
              
               $http.post('/profile', fd, {
                  transformRequest: angular.identity,
                  headers: {'Content-Type': undefined}
               })
            
               .success(function(response){
			     $scope.image=response;
				 $('#profilefile').val('');
               })
            
               .error(function(reponse){
               });
                
				
				
		    	 showUserProfile();
			};
			
			$scope.logout = function(){
				console.log("IM IN LOG OUT METHOD")
				$cookies.remove('token');
				$cookies.remove('currentUser');
				$rootScope.token = null;
				$rootScope.currentUser = null;
			};

	//	});

		});


		app.controller('HomeController', function($rootScope, $scope, $http, $cookies){
               
			var socket = io.connect('http://localhost');
			socket.on('connect', function(socket){
				console.log('SOCKET IO');
			});
			socket.on('{text: req.body.newMessage}', function(data){
				//getMessages();
				
				getMessagesbyRoomAndTask($rootScope.meetingRoomName, $rootScope.meetingTaskName);
			});
            //location.reload(); 
			$scope.SubmitNewMessage = function(meetingRoomName, meetingTaskName){
				//console.log("Room"+meetingRoomName+", Task: "+meetingTaskName);
				$http.post('/messages', {newMessage: $scope.newMessage, roomName: meetingRoomName, taskName: meetingTaskName},
				 {headers: {
				 	'authorization': $rootScope.token
				 }}).then(function(){
					//getMessages();
					//console.log("HELLOWW"+meetingRoomName);
					getMessagesbyRoomAndTask(meetingRoomName, meetingTaskName);
					$scope.newMessage = '';
				});
			};
			function getTeams(){
				$http.put('/teams',{username:$rootScope.currentUser}).then(function(response){
					console.log($rootScope.currentUser);
					$scope.teams = response.data;
					console.log($scope.teams);
				});
			}
			getTeams();

			//This function gets rooms based on meetingTeamName teams
		/*	function getRooms(meetingTeamName){
				//console.log("Printing the task "+meetingRoomName);
				$http.put('/rooms/find', {meetingTeamName: meetingTeamName}).then(function(response){
					//console.log($rootScope.meetingTaskName+" Rootscope taskname");`
					$scope.rooms = response.data;
					//console.log($scope.tasks);
				});
			}*/
			//AssignTeamNameArg(team.name)
				$scope.AssignTeamNameArg = function(teamName){
				
				 	//$cookies.put('teamToken', res.data.token);
					$cookies.put('teamName', teamName);
					//$rootScope.teamName = res.data.token;
					$rootScope.teamName = teamName;

					//getTeams();
					//getRooms();

					meetingTeamName = teamName;

					//console.log(meetingTeamName+"TEEAAAM");
					$rootScope.meetingTeamName = teamName;
					//$scope.teamName = '';
					//getRooms();
					console.log($rootScope.meetingTeamName);
					getRooms($rootScope.meetingTeamName);
					//getChatMessagesByRoom();
					//getChatMessagesByRoomAndTask(meetingTaskName, $rootScope.roomName);
				
			};
			function getRooms(meetingTeamName){
				console.log("Printing the team "+ $rootScope.meetingTeamName);
				$http.put('/rooms/find', {meetingTeamName: $rootScope.meetingTeamName,username:$rootScope.currentUser}).then(function(response){
					//console.log($rootScope.meetingTaskName+" Rootscope taskname");`
					$scope.rooms = response.data;
					//console.log($scope.tasks);
				});
			}
			//This function gets rooms
			/*function getRooms(){
				$http.get('/rooms').then(function(response){
					$scope.rooms = response.data;
				});
			}*/
			//This function gets tasks based on meetingRoom
		/*	function getTasks(meetingRoomName){
				//console.log("Printing the task "+meetingRoomName);
				$http.put('/tasks', {meetingRoomName: meetingRoomName}).then(function(response){
					//console.log($rootScope.meetingTaskName+" Rootscope taskname");`
					$scope.tasks = response.data;
					//console.log($scope.tasks);
				});
			}*/
                
				function showTaskandRoomforUser(meetingRoomName)
	   {
           $http.put('/show/loginUser/home',{name:$rootScope.currentUser,taskName:$rootScope.meetingTaskName, roomName:meetingRoomName}).then(function(response){
                  console.log($rootScope.currentUser);
				  //console.log($rootScope.meetingTaskName);
				  console.log(meetingRoomName);
				  $scope.tasks = response.data;
				   console.log($scope.tasks);

                 });
	   }
	  /* $scope.reload = function()
       {
        location.reload(); 
       }*/
	   //showTaskandRoomforUser();			
			//Login function
			$scope.signin = function(){
				//console.log($scope.username);
				$http.put('/users/signin', {username: $scope.username, password: $scope.password}).then(function(res){
					//console.log(res.data.token);
					$cookies.put('token', res.data.token);
					$cookies.put('currentUser', $scope.username);
					$rootScope.token = res.data.token;
					$rootScope.currentUser = $scope.username;
					//location.reload();
					//alert('Successfully signed in!');
				}, function(err) {
					alert('Wrong Username or Password');
				});
			};



			//Logout Function
			$scope.logout = function(){
				console.log("IM IN LOG OUT METHOD")
				$cookies.remove('token');
				$cookies.remove('currentUser');
				$rootScope.token = null;
				$rootScope.currentUser = null;
			};


			//Remove a message
			$scope.removeMessage = function(message){
				$http.put('/messages/remove', 
					{message: message}, 
					{headers: {
				 		'authorization': $rootScope.token
				 	}}).then(function(){
					//getMessages();
					getMessagesbyRoomAndTask($rootScope.meetingRoomName, $rootScope.meetingTaskName);
				});
			};

			//This function adds a like to the feed (adds username)
			$scope.likeMessage = function(user, message, date){
				//console.log($rootScope.currentUser+ " liked a post: "+message+", date: "+date);
				$http.put('/like', {username: $rootScope.currentUser, messageText: message, messageDate: date}).then(function(response){
					console.log(response.data+"Response");
					getMessagesbyRoomAndTask($rootScope.meetingRoomName, $rootScope.meetingTaskName);
				});
			};
			
			//This function adds a comment to the feed
			$scope.submitNewComment = function(user, message, date, comment){
				console.log($rootScope.currentUser+ " commented on a post: "+message+", date: "+date+" comment: "+comment);
				$http.put('/comment', {username: $rootScope.currentUser, messageText: message, messageDate: date, comment: comment}).then(function(response){
					//console.log(response.data+"Response");
					getMessagesbyRoomAndTask($rootScope.meetingRoomName, $rootScope.meetingTaskName);
				});
			};

			//Range for n number function(min, max)
			$scope.range = function(min, max, step){
				var input = [];
				//console.log(input.push()+" Input2");
				for(var i=min; i<=max; i++){
					step = step || 2;
					//var pushit= input.push(i);
					console.log(step+" Input");
					input.push(i);
				}
				return input;
			};


			//Useless function. Can be deleted.
			function getLikes(likes){
				//$http.put('/like', {username: $rootScope.currentUser, messageText: message, messageDate: date}).then(function(response){
					//console.log(response.data);
					//getLikes(response.data);
					// $scope.messageLikes = response.data;
					// getLikes($scope.messageLikes);
					// console.log($scope.messageLikes+" Response for Likes");
					angular.forEach(likes, function(item, index){
						item.likes.splice(0,1);
						$scope.likes = item.likes;
						console.log($scope.likes);
					});
				//});
				
			}
			function getMessageLikes(username){

			}
			// function getMessages(){
			// 	$http.get('/messages').then(function(response){
			// 	$scope.messages = response.data;
			// 	});
			// }
			
			function getMessagesbyRoomAndTask(meetingRoomName, meetingTaskName){
				$http.put('/messages',{roomName: meetingRoomName, taskName: meetingTaskName}).then(function(response){
					$scope.messages = response.data;
					getLikes($scope.messages);
					//console.log(response.data);
				});
			}
			
			
			//This function will get links on click of a button and will call the getTasks(meetingRoomName) method 
			$scope.showLinks = function(meetingRoomName){
				if(linkButton == false ){
					$scope.clickedLinkButton = true;
					linkButton = true;
					//getTasks(meetingRoomName);
					console.log(meetingRoomName);
					showTaskandRoomforUser(meetingRoomName);
					getFeedsByRoomNameAng(meetingRoomName);
					//getRooms(meetingTeamName);
				}
				else{
					$scope.clickedLinkButton = false;
					linkButton = false;
				}
			}
			

			
			function getFeedsByRoomNameAng(meetingRoomName){
				//getTasks(meetingRoomName);
                showTaskandRoomforUser(meetingRoomName);
				$rootScope.meetingRoomName = meetingRoomName;

			}
			//$scope.SubmitNewLink = function(meetingTaskName){
			$scope.getFeedsByTasks = function(taskName){
				$scope.clickedLinkButton = false;
				$rootScope.meetingTaskName = taskName;
				//console.log($rootScope.meetingTaskName+"Hello");
				//console.log($rootScope.meetingRoomName+"ueli"+taskName);
				getMessagesbyRoomAndTask($rootScope.meetingRoomName, taskName);
			}


			function showUserProfile()
			{
				$http.put('/show/User/profile/room',{name:$rootScope.currentUser}).then(function(response){
					//console.log($rootScope.currentUser);
					//console.log($rootScope.meetingTaskName);
					$scope.userProfile = response.data;
					$rootScope.userProfile=$scope.userProfile;
					angular.forEach($scope.userProfile, function(item, index){
					//item.users.splice(0,1);
					$scope.users = item.file;
					$scope.currentImage=item.file[0].filename;
					$scope.defaultImage=item.file;
					$rootScope.defaultImage=$scope.defaultImage;
					$rootScope.currentImage=$scope.currentImage;
					console.log($scope.currentImage);
					console.log($scope.defaultImage);
					});
							//console.log(response.data);
								//$scope.users=response.data;
				});
			}

			showUserProfile();





			//getMessages();
			getRooms();
		});


		


		app.controller('SignupController', function($scope, $http){
			$scope.submitSignup = function(){
				var newUser = {
					username: $scope.username,
					password: $scope.password,
					fullname: $scope.fullname,
					email: $scope.email
				};
				$http.post('/users', newUser).then(function(){
					alert('User Successfully created');
				},function(err){
					alert('User already exists');
				});
			};
		});
//, [ '$scope','$rootScope','fileUpload','$http',function($scope,$rootScope, fileUpload,$http)

		app.controller('RoomController',function($cookies,$scope,$rootScope,$http){
						
			var socket = io.connect('http://localhost');
			socket.on('connect', function(socket){
				console.log('SOCKET IO');
				//location.reload();
			});
			socket.on('{text: req.body.newChatMessage}', function(data){

			
				getChatMessagesByRoomAndTask($rootScope.roomName, meetingTaskName);
				
				//getChatMessagesByRoomArg(meetingRoomName);
			});
			socket.on('{text: req.body.newLink}', function(data){
				getLinksByRoomAndTask(meetingTaskName, $rootScope.roomName);
				//getChatMessagesByRoomAndTask($rootScope.roomName, meetingTaskName);
				//getChatMessages();
				//getChatMessagesByRoomArg($rootScope.roomName);
				//console.log("Hello everyone"+$rootScope.taskName+" AND"+$rootScope.roomName);
				//console.log(+$rootScope.taskNamee+" AND"+$rootScope.roomName);
				getChatMessagesByRoomAndTask($rootScope.taskName, $rootScope.roomName);
				
				
				//getChatMessagesByRoomArg(meetingRoomName);

			});
			//'{file: req.body.newUploadFile}'
               socket.on('{file: req.body.newUploadFile}', function(data){
				//getLinksByRoomAndTask(meetingTaskName, $rootScope.roomName);
				//getChatMessagesByRoomAndTask($rootScope.roomName, meetingTaskName);
				getFilesByRoomAndTask(meetingTaskName, $rootScope.roomName);
				//getChatMessagesByRoomArg(meetingRoomName);

			});


		


			$scope.SubmitNewChatMessage = function(){
				//console.log($rootscope.meetingTaskName+" Rootscope taskname");
				

				$http.post('/chat/messages', {newChatMessage: $scope.newChatMessage, roomName: $rootScope.roomName, taskName: meetingTaskName},
				 {headers: {
				 	'authorization': $rootScope.token
				 }}).then(function(){

					//getChatMessagesByRoom();
					//getChatMessagesByRoomArg($rootScope.roomName);
					//console.log(meetingTaskName+"AND AND AND"+ $rootScope.roomName);
					//console.log(meetingTaskName+ "Hellow boy2");
					//console.log($rootscope.taskName+ "Hellow boy");
					//getChatMessagesByRoomAndTask(meetingTaskName, $rootScope.roomName);
					getChatMessagesByRoomAndTask($rootScope.roomName, meetingTaskName);
					$scope.newChatMessage = '';
				});
			};

			
			$scope.SubmitNewLink = function(){
				//console.log($rootscope.meetingTaskName+" Rootscope taskname");
				

				$http.post('/chat/links', {newLink: $scope.newLink, roomName: $rootScope.roomName, taskName: meetingTaskName, newLabel: $scope.newLabel},
				 {headers: {
				 	'authorization': $rootScope.token
				 }}).then(function(){
					
					$http.post('/chat/messages', {newChatMessage: $scope.newLink, roomName: $rootScope.roomName, taskName: meetingTaskName},
					{headers: {
						'authorization': $rootScope.token
					}}).then(function(){

						getChatMessagesByRoomAndTask($rootScope.roomName, meetingTaskName);
						$scope.newChatMessage = '';
					});
					
					getLinksByRoomAndTask(meetingTaskName, $rootScope.roomName);
					$scope.newLink = '';
					$scope.newLabel = '';
				});
			};

			$scope.AssignTeamNameArg = function(teamName){
				
				 	//$cookies.put('teamToken', res.data.token);
					$cookies.put('teamName', teamName);
					//$rootScope.teamName = res.data.token;
					$rootScope.teamName = teamName;

					//getTeams();
					//getRooms();

					meetingTeamName = teamName;

					//console.log(meetingTeamName+"TEEAAAM");
					$rootScope.meetingTeamName = teamName;
					//$scope.teamName = '';
					//getRooms();
					console.log($rootScope.meetingTeamName);
					getRooms($rootScope.meetingTeamName);
					//getChatMessagesByRoom();
					//getChatMessagesByRoomAndTask(meetingTaskName, $rootScope.roomName);
				
			};
			//This function is for assigning a Team name so that rooms/projects can be selected
			$scope.AssignTeamName = function(){
				$http.put('/newTeam', {newTeam: $scope.teamName,username:$rootScope.currentUser},
				 {headers: {
				 	'authorization': $rootScope.token
				 }}).then(function(res){
				 	//console.log($scope.roomName);
					

				 	$cookies.put('teamToken', res.data.token);
					$cookies.put('teamName', $scope.teamName);
					$rootScope.teamName = res.data.token;
					$rootScope.teamName = $scope.teamName;

					getTeams();
					//getRooms();

					meetingTeamName = $scope.teamName;
					//console.log(meetingRoomName);
					$rootScope.meetingTeamName = $scope.teamName;
					$scope.teamName = '';
					//getRooms();
					//getChatMessagesByRoom();
					//getChatMessagesByRoomAndTask(meetingTaskName, $rootScope.roomName);
				}, function(err){
					alert('Team already exists');
				});
			};

			//Assign a Room name so that tasks can be selected
			$scope.AssignRoomName = function(){
				console.log(meetingTeamName+" Team Name");
				$http.put('/newRoom', {newRoom: $scope.roomName, teamName: meetingTeamName,username:$rootScope.currentUser},
				 {headers: {
				 	'authorization': $rootScope.token
				 }}).then(function(res){
				 	//console.log($scope.roomName);
					

				 	$cookies.put('roomToken', res.data.token);
					$cookies.put('roomName', $scope.roomName);
					$rootScope.roomToken = res.data.token;
					$rootScope.roomName = $scope.roomName;

					

					meetingRoomName = $scope.roomName;
					//console.log(meetingRoomName);
					$rootScope.meetingRoomName = $scope.roomName;
					$scope.roomName = '';
					//getChatMessagesByRoom();
					getRooms(meetingTeamName);
					getChatMessagesByRoomAndTask(meetingTaskName, $rootScope.roomName);
				}, function(err){
					alert('Room/Project already exists');
				});
			};

			//This function creates a task from front end page room.html
			$scope.AssignTaskName = function(){
				//console.log("Rootsccope"+$rootScope.meetingRoomName);
				$http.put('/newTask', {newTask: $scope.taskName, loginUser:$rootScope.currentUser, newRoom: $rootScope.meetingRoomName,newTeam:$rootScope.meetingTeamName},
				 {headers: {
				 	'authorization': $rootScope.token
				 }}).then(function(res){
					

					$cookies.put('taskToken', res.data.token);
					$cookies.put('taskName', $scope.taskName);
					$rootScope.taskToken = res.data.token;
					$rootScope.taskName = $scope.taskName;

					meetingTaskName = $scope.taskName;
					
					//getTasks($rootScope.meetingRoomName);
					showTaskandRoomforUser();

					//Extra added line -Reminder
					getChatMessagesByRoomAndTask($rootScope.roomName, $rootScope.taskName);
					//getChatMessagesByRoomAndTask($rootScope.taskName, $rootScope.roomName);
					
					//console.log(meetingTaskName+"Boa");
					
					$rootScope.meetingTaskName = $scope.taskName;
					$scope.taskName = '';

					
					
					//res.send();
				},function(err){
					alert('Task already exists in this room');
				});
			};



			//This function adds people in tasks (front end room.html)
			$scope.addPeopleInTasks = function(){
				//console.log("Current Task: "+ meetingTaskName);
				//console.log("Current Room: "+ $scope.pername);
				$http.post('/room/task/user', {name: $scope.username, taskName: meetingTaskName, roomName: $rootScope.meetingRoomName,teamName:meetingTeamName}).then(function(response){
					//console.log("User added");
					console.log("Current Room: "+ $scope.username);
					selectedUser=$scope.username;
					$rootScope.selectedUser=$scope.username;
					getUsersBasedOnTask(meetingTaskName);
					$scope.username = "";
					var cond=$rootScope.currentUser;
					//if(selectedUser=="hassam")
					//{
						//console.log("alert");
					//alert(selectedUser+" is added in " +meetingTeamName+ " ,"+$rootScope.meetingRoomName+ " and "+meetingTaskName);
				    //location.reload();	
				//}
				},function(err){
					console.log(err);
					if(err.status == 404){
						alert('User does not exist');
					}
					else if(err.status == 400){
						alert('User already exists');
					}
						
				});
			};

			//This method gets users based on task to show on front
			function getUsersBasedOnTask(taskName){
				$http.put('/showUsers',{taskName: taskName}).then(function(response){
					$scope.taskUsers = response.data;
					angular.forEach($scope.taskUsers, function(item, index){
						item.users.splice(0,1);
						$scope.users = item.users;
					});
				});
			}

			//This function displays a list of tasks and users when the user clicks on rooms on rooms.html page
			$scope.displayTasksAndUsers = function(meetingRoomName){
				getTasks(meetingRoomName);
			}

			// function getUsers(){
			// 	$http.get('/users/find').then(function(response){
			// 		$scope.users = response.data;
			// 	});
			// }

			
// check that
			//This function will get users based on task
			// function getUsersBasedOnTask()  {
			// 	$http.get('/users/find/task').then(function(response){
			// 		console.log(response.data);
			// 		$scope.taskUsers = response.data;
			// 	});
			// }
			
			/*function getMessages(){
				$http.get('/messages').then(function(response){
					$scope.messages = response.data;
				});
			}*/
			// function getChatMessagesByRoom(){
			// 	$http.get('/chat/messages/room').then(function(response){
			// 		//console.log()
			// 		$scope.chatMessages = response.data;
			// 		//chatMessagess = $scope.chatMessages;
			// 		//console.log($scope.chatMessages);
			// 	});
			// }

			function getChatMessagesByRoomAndTask(meetingRoomName, meetingTaskName){
				$http.put('/chat/messages/roomandtask', {roomtaskName: meetingTaskName, meetingRoomName: meetingRoomName}).then(function(response){
					$scope.chatMessages = response.data;
					//chatMessagess = $scope.chatMessages;
					//console.log($scope.chatMessages);
				});
			}
			function getLinksByRoomAndTask(meetingTaskName, meetingRoomName){
				$http.put('/chat/links/roomandtask', {roomtaskName: meetingTaskName, meetingRoomName: meetingRoomName}).then(function(response){
					//console.log(response.data)
					$scope.links = response.data;
					//chatMessagess = $scope.chatMessages;
					//console.log($scope.chatMessages);
				});
			}

			function getFilesByRoomAndTask(meetingTaskName, meetingRoomName){
				$http.put('/chat/Files/roomandtask', {roomtaskName: meetingTaskName, meetingRoomName: meetingRoomName}).then(function(response){
					//console.log(response.data)
					$scope.Files = response.data;
					//chatMessagess = $scope.chatMessages;
					console.log($scope.Files);
				});
			}
     
			function getChatMessagesByRoomArg(meetingRoomName){
				//console.log("hello");
				//console.log(meetingRoomName);
				$http.put('/chat/messages/roomNameArg', {meetingRoomName: meetingRoomName}).then(function(response){
					//console.log(newRoom);
					$scope.chatMessages = response.data;
					meetingRoomName = $rootScope.roomName;
					//chatMessagess = $scope.chatMessages;
					//console.log($scope.chatMessages);
				});
			}

			function getChatMessagesByTaskArg(meetingTaskName){
				//console.log("hello");
				//console.log(meetingRoomName);
				$http.put('/chat/messages/taskNameArg', {meetingTaskName: meetingTaskName}).then(function(response){
					//console.log(newRoom);
					$scope.chatMessages = response.data;
					meetingTaskName = $rootScope.taskName;
					//chatMessagess = $scope.chatMessages;
					//console.log($scope.chatMessages);
				});
			}


			$scope.getChatMessagesByTeamNameAng = function(meetingTeamName){
				//console.log("hello2");
				//console.log(meetingRoomName+"front 2");
				//console.log(meetingRoomName+"New");
				

				//*****WAITING METHOD***
				//getRooms(meetingTeamName);
				
				// $http.put('/teams/rooms', {meetingTeamName: meetingTeamName}).then(function(response){
				// 	//console.log(newRoom);
				// 	//$scope.chatMessages = response.data;
				// 	$rootScope.meetingTeamName = meetingTeamName;
				// 	$rootScope.teamName = meetingTeamName;
				// 	meetingTeamName = $rootScope.teamName;
				// 	//chatMessagess = $scope.chatMessages;
				// 	//console.log($scope.chatMessages);
				// });
				$rootScope.meetingTeamName = meetingTeamName;
				$rootScope.teamName = meetingTeamName;
				meetingTeamName = $rootScope.teamName;

			}

			$scope.getChatMessagesByRoomNameAng = function(meetingRoomName){
				//console.log("hello2");
				//console.log(meetingRoomName+"front 2");
				//console.log(meetingRoomName+"New");
				getRooms(meetingTeamName+"TEAM NAME FOR ROOM");
				//getTasks(meetingRoomName);
				
				$http.put('/chat/messages/roomNameAng', {meetingRoomName: meetingRoomName}).then(function(response){
					//console.log(newRoom);
					//$scope.chatMessages = response.data;
					$rootScope.meetingRoomName = meetingRoomName;
					$rootScope.roomName = meetingRoomName;
					meetingRoomName = $rootScope.roomName;
					showTaskandRoomforUser();
					//chatMessagess = $scope.chatMessages;
					//console.log($scope.chatMessages);
				});

			}

			//Function to get Chat Messages based on task name on front end
			$scope.getChatMessagesByTaskNameAng = function(meetingRoomName, taskName){

				$http.put('/chat/messages/taskNameAng', {roomtaskName: taskName, meetingRoomName: meetingRoomName}).then(function(response){

					// $scope.chatMessages = response.data;
					// meetingTaskName = taskName;
					// $rootScope.meetingTaskName = $scope.taskName;
					// $scope.taskName = '';
					//console.log("Room Name: "+meetingRoomName+" AND Task Name: "+taskName);
					getLinksByRoomAndTask(taskName, meetingRoomName);
                    	getFilesByRoomAndTask(taskName,meetingRoomName);
					$scope.chatMessages = response.data;
					$rootScope.meetingTaskName = taskName;
					$rootScope.taskName = meetingTaskName;
					meetingTaskName = taskName;

					$scope.showTextBox();
					getUsersBasedOnTask(meetingTaskName);
					getChatMessagesByRoomAndTask( meetingRoomName, meetingTaskName);

				});
			}

			function getChatMessages(){
				$http.get('/chat/messages').then(function(response){

					$scope.chatMessages = response.data;
				});
			}

			/*function getRooms(){
				$http.get('/rooms').then(function(response){
					$scope.rooms = response.data;
				});
			}*/
			function getTeams(){
				$http.put('/teams',{username:$rootScope.currentUser}).then(function(response){
					$scope.teams = response.data;
				});
			}
			//This function gets rooms based on meetingTeamName teams
			function getRooms(meetingTeamName){
				console.log("Printing the team "+ $rootScope.meetingTeamName);
				$http.put('/rooms/find', {meetingTeamName: $rootScope.meetingTeamName,username:$rootScope.currentUser}).then(function(response){
					//console.log($rootScope.meetingTaskName+" Rootscope taskname");`
					$scope.rooms = response.data;
					//console.log($scope.tasks);
				});
			}

		/*	function getTasks(meetingRoomName){
				//console.log("Printing the task "+meetingRoomName);
				$http.put('/tasks', {meetingRoomName: meetingRoomName}).then(function(response){
					
					//console.log($rootScope.meetingTaskName+" Rootscope taskname");`
					$scope.tasks = response.data;
					//console.log($scope.tasks);
				});
			}*/

			//This method shows a linkbox on room page when link button is clicked
			$scope.showLinkBox = function(){
				$scope.clickedLink = true;
				$scope.clickedText = false;
				$scope.clickedFile = false;
			}
			//This method shows a filebox on room page when link button is clicked
			$scope.showFileBox = function(){
				$scope.clickedFile = true;
				$scope.clickedLink = false;
				$scope.clickedText = false;
			}

			//This method shows a text on room page when link button is clicked
			$scope.showTextBox = function(){
				$scope.clickedText = true;
				$scope.clickedLink = false;
				$scope.clickedFile = false;
			}

			//This function will get links on click of a button
			$scope.showLinks = function(){
				if(linkButton == false ){
					$scope.clickedLinkButton = true;
					linkButton = true;
				}
				else{
					$scope.clickedLinkButton = false;
					linkButton = false;
				}
			}

			//This function will get links on click of a button
			$scope.showFiles = function(){
				if(fileButton == false ){
					$scope.clickedFileButton = true;
					fileButton = true;
				}
				else{
					$scope.clickedFileButton = false;
					fileButton = false;
				}
			}
			//This function will get links on click of a button
			$scope.showTasks = function(){
				if(taskButton == false ){
					$scope.clickedTaskButton = true;
					taskButton = true;
				}
				else{
					$scope.clickedTaskButton = false;
					taskButton = false;
				}
			}

$scope.ShowClickUserProfile = function(selectedUser)
{
    	$http.put('/show/click/user/profile', {username:selectedUser}).then(function(response){
					//console.log($rootScope.meetingTaskName+" Rootscope taskname");
				     $rootScope.selectedUser=selectedUser;
					$scope.clickUserprofile = response.data;
					$rootScope.clickUserprofile = response.data;
					console.log("profile");
					console.log(selectedUser);
					console.log($scope.clickUserprofile);
					
				});


}


			$scope.submit = function()
			{


                 var fd = new FormData();
               for(var key in $scope.myFile)
               
               fd.append(key,$scope.myFile[key]);
              
               $http.post('/profile/room', fd, {
                  transformRequest: angular.identity,
                  headers: {'Content-Type': undefined}
               })
            
               .success(function(response){
			     $scope.image=response;
				 //$scope.image=data;
				//$scope.myFile={};
				$('#examplefile').val('');
				angular.forEach($scope.image, function(item, index){
                        $rootScope.image=item.filename;
					//console.log($rootScope.image);

					var extn = $rootScope.image.split(".").pop();
						//console.log(extn);
						if( extn == 'jpg' || extn == 'jpeg' || extn == 'png' || extn == 'gif')
						{
							ImageCatcher($rootScope.image);
							console.log("file uploaded");
						}
						else{ 
							 FileCatcher($rootScope.image);

						}
						showUploadfile($rootScope.image);
				});
               })
            
               .error(function(reponse){
               });
       
				 
			};


			function FileCatcher(image)
			{

                //console.log(image);
				//console.log($rootScope.roomName);
				//console.log(meetingTaskName);

                   $http.post('/chat/messages', {newChatMessage:image, roomName: $rootScope.roomName, taskName: meetingTaskName},
				 {headers: {
				 	'authorization': $rootScope.token
				 }}).then(function(){

					//getChatMessagesByRoomAndTask(meetingTaskName, $rootScope.roomName);
					getChatMessagesByRoomAndTask($rootScope.roomName, meetingTaskName);
					//$scope.newChatMessage = '';
				});

			}


			function ImageCatcher(image)
			{

                //console.log(image);
				//console.log($rootScope.roomName);
				//console.log(meetingTaskName);

                   $http.post('/chat/messages', {newChatImage:image, roomName: $rootScope.roomName, taskName: meetingTaskName},
				 {headers: {
				 	'authorization': $rootScope.token
				 }}).then(function(){

					//getChatMessagesByRoomAndTask(meetingTaskName, $rootScope.roomName);
					getChatMessagesByRoomAndTask($rootScope.roomName, meetingTaskName);
					//$scope.newChatMessage = '';
				});

			}

			// function show upload files
			function showUploadfile(image)
			{

                //console.log(image);
				//console.log($rootScope.roomName);
				//console.log(meetingTaskName);

                   $http.post('/chat/messages/uploadFile', {newUploadFile:image,newFileName:$scope.newFileName, roomName: $rootScope.roomName, taskName: meetingTaskName},
				 {headers: {
				 	'authorization': $rootScope.token
				 }}).then(function(){

					//getChatMessagesByRoomAndTask(meetingTaskName, $rootScope.roomName);
					getFilesByRoomAndTask(meetingTaskName,$rootScope.roomName);
					$scope.newFileName = '';
				});

			}

			//getFilesByRoomAndTask();


			function showUserProfile()
			{
				$http.put('/show/User/profile/room',{name:$rootScope.currentUser}).then(function(response){
							//console.log($rootScope.currentUser);
							//console.log($rootScope.meetingTaskName);
							$scope.userProfile = response.data;
							$rootScope.userProfile=$scope.userProfile;
							angular.forEach($scope.userProfile, function(item, index){
						//item.users.splice(0,1);
						$scope.users = item.file;
						$scope.currentImage=item.file[0].filename;
						$scope.defaultImage=item.file;
						$rootScope.defaultImage=$scope.defaultImage;
						$rootScope.currentImage=$scope.currentImage;
						//console.log($scope.currentImage);
						//console.log($scope.defaultImage);
					});
							//console.log(response.data);
								//$scope.users=response.data;
					});
			}
			// function search user

			function showUsers()
			{

				$http.get('/users/invite').then(function(response){
				// console.log("Get user");
					$scope.RegisterUsers=response.data;
				});
			} 
			showUsers();



function showTaskandRoomforUser()
	   {
           $http.put('/show/loginUser',{name:$rootScope.currentUser,taskName:meetingTaskName, roomName: $rootScope.meetingRoomName}).then(function(response){
                  console.log($rootScope.currentUser);
				  console.log(meetingTaskName);
				  console.log($rootScope.meetingRoomName);
				  $scope.userTasks = response.data;
				   console.log(response.data);

                 });
	   }
	   showTaskandRoomforUser();






			showUserProfile();
            getTeams();

			//getChatMessagesByRoomArg("Room "+roomNumber);
			//meetingRoomName = $rootScope.roomName;
			//getChatMessagesByRoomArg($rootScope.roomName);
			//console.log("HELLOWW "+$rootscope.taskName+" inhk "+$rootScope.roomName);
			
			//console.log(meetingTaskName+ "Helowsksdjk");
			//getChatMessagesByRoomAndTask(meetingTaskName, $rootScope.roomName);
			
			
			//console.log(meetingTaskName+ "elo");
			//console.log(meetingTaskName+ "orange");
			
			//getChatMessagesByTaskArg("UI Design");

			//console.log("HELLO "+meetingRoomName);
			//console.log("HELLO2 " +$rootScope.roomName);
			//getChatMessagesByRoomArg(meetingRoomName);
			//getChatMessages();
			//getTeams();
			getRooms();
			////getUsers();
			//getUsersBasedOnTask();

			//getTasks($rootScope.taskName);
			//console.log( $rootScope.roomName+" front");
			

			//console.log($scope.chatMessage);
		});


	</script>
</head>
<body>
	<!--
	<div class="panel panel-default">
			<h1 class="page-title"><a href="#/" >Hermius </h1></a>
			<span class=" glyphicon glyphicon-user pull-right" style="color: black; margin-right: 15px"></span>
	</div>
	-->
<div id="wrapper">




</div>
	
	<div ng-view style="margin-top: 80px;">
		
	</div>


</body>
</html>